% -*- root: 00-main.tex -*-
\section{Discussion}
\label{sec:regseg-discussion}
We present \regseg{}, a simultaneous segmentation and registration method that
  maps a set of nested surfaces into a multivariate target-image.
The nonlinear registration process evolves driven by the fitness of the
  picewise-smooth classification of voxels in the target volume imposed
  by the current mapping of the surfaces.
We propose \regseg{} to incorporate anatomical information extracted from \gls*{t1}
  images into the corresponding \gls*{dmri} of the same subject.
Previously, joint segmentation and registration has been applied successfully to
  other problems such as longitudinal object tracking \citep{paragios_level_2003}
  and atlas-based segmentation \citep{gorthi_active_2011}.
The most common approach to solve the problem simultaneously is optimizing a deformation
  model (registration) that supports the evolution the active contours (segmentation),
  like \cite{paragios_level_2003,yezzi_variational_2003}.
\Regseg{} can be seen as a particular case of atlas-based segmentation, replacing the atlas
  by the structural image of the subject (\emph{structure-informed segmentation}).
However, the majority of atlas-based segmentation methods, such as \citep{gorthi_active_2011},
  use a multiphase level set function to register several active contours.
Alternatively, \regseg{} implements the active contours with a hierarchical set of explicit
  surfaces (triangular meshes) that substitute the multiphase level sets, and registration
  is driven by shape-gradients \citep{herbulot_segmentation_2006}.

An important antecedent of \regseg{} is \emph{bbregister} \citep{greve_accurate_2009}.
The tool has been widely adopted as the standard registration method to be used along with the \gls*{epi}
  correction of choice.
It implements a linear mapping, and uses 3D active contours \emph{with edges} to
  search for intensity boundaries in the \lowb{} image.
The active contours are initialized using surfaces extracted from the \gls*{t1} using
  \emph{FreeSurfer} \citep{fischl_freesurfer_2012}: the \emph{pial} surface (exterior of the
  cortical \gls*{gm}) and the \emph{white} surface (the \gls*{wm}/\gls*{gm} interface).
The \lowb{} image only includes a detectable frontier for the pial surface, and thus
  \emph{bbregister} is limited to align the pial contour in this application.
To overcome the problem of nonlinear distortions, \emph{bbregister} excludes the
  regions that are typically warped from the boundary search.
Indeed, the distortion must be addressed separately because it is not supported by
  the affine transformation model.
Conversely, the deformation model of \regseg{} is nonlinear and the active contours are
  \emph{without-edges} \citep{chan_active_2001}.
The contours are without edges because the \gls*{fa} and \gls*{adc} maps do
  not present steep image gradients (edges) but the anatomy can be identified
  by looking for piece-wise smooth homogeneous regions.


Recently, \cite{guyader_combined_2011} proposed a simultaneous segmentation and
  registration method in 2D using level sets and a nonlinear elasticity smoother on the
  displacement vector field, which preserves the topology even with very large deformations.
\Regseg{} includes an anisotropic regularizer for the displacements field proposed by
  \cite{nagel_investigation_1986}.
This regularization strategy conceptually falls in the midway between the Gaussian smoothing
  generally included in most of the existing methodologies, and the complexity of
  the elasticity smoother of \cite{guyader_combined_2011}.
Other minor features that differ from current methods in joint segmentation and registration are
  the support of multivariate target-images and the efficient computation of the shape-gradients
  implemented with sparse matrices.

We verified that precise segmentation and registration of a set of surfaces into multivariate
  data is possible on digital phantoms.
We randomly deformed four different phantom models to mimic three homogeneous regions
  (\gls*{wm}, \gls*{gm}, and \acrlong*{csf}) and we used them to simulate \gls*{t1}
  and \gls*{t2} images at two resolution levels.
After registration with \regseg{}, we measured the Hausdorff distance between the
  projected contours obtained using the ground-truth warping and our estimates.
We concluded that the errors were significantly lower than the voxel size.
We also assessed the 95\% \gls*{ci}, which yielded an aggregate interval of
  0.64--0.66 [mm] for the low resolution phantoms (2.0 mm isotropic voxel) and
  0.34--0.38 [mm] for the high resolution phantoms (1.0 mm isotropic).
Therefore, we also concluded that the error was bounded above by half of the
  voxel size.
\revcomment[RV\#1(C.8)]{%}
The distributions of errors along surfaces varied importantly depending on the shape of the
  phantom (see \autoref{fig:regseg-phantom}B).
The misregistration error of the ``gyrus'' phantom showed a much lower spread than that
  for the other shapes.
We argue that the symmetry of those other shapes posed difficulties in driving the contours
  towards the appropriate region and produced a \emph{sliding} between the faces of the
  surfaces and their ground-truth position.
This effect should not be present in real datasets, thanks to the very convoluted cortical
  layer, and the directional restriction of distortion.}

\todo{real data}
Once the method was validated, we applied it in the task of identifying or incorporating
  structural information in 16 real \gls*{dmri} datasets.
The segmentation of some anatomical structures in the diffusion dataset is necessary in
  current methods involved in the connectome extraction, such as the structure-informed
  reconstruction of \gls*{dmri} data \citep{jeurissen_multitissue_2014,daducci_accelerated_2015},
  the anatomically constrained tractography \citep{smith_anatomicallyconstrained_2012},
  and the imposition of the cortical parcellation mapped from the \gls*{t1} image
  \citep{hagmann_mapping_2008}.
The problem was firstly addressed using image segmentation approaches in the native diffusion
  space, without definite and compelling results.
With the introduction of retrospective correction methods for the \emph{\gls*{epi} distortions}
  and image registration approaches, the task has been typically solved in a two-step approach.
First, the \glspl*{dwi} are corrected for \emph{\gls*{epi} distortions} by estimating
  the nonlinear-deformation field from extra MR acquisitions
  \citep{jezzard_correction_1995,chiou_simple_2000,cordes_geometric_2000,
  kybic_unwarping_2000}.
Second, mapping the structural information from the corresponding \gls*{t1} image
  using a linear registration tool like \emph{bbregister} \citep{greve_accurate_2009}.
The current activity on improving correction methods \citep{irfanoglu_drbuddi_2015} and
  the comeback of segmentation of \gls*{dmri} in its native space
  \citep{jeurissen_tissuetype_2015} proof the open interest of this application.
\Regseg{} addresses this joint problem in a single step and it does not require any additional
  acquisition other than the minimal protocol comprehending only \gls*{t1} and \gls*{dmri} images.
This situation is found commonly in historical datasets.
Moreover, since the structural information is projected into the native space of \gls*{dmri},
  reconstruction and tractography can be performed without resampling data to an undistorted
  space.

We evaluated \regseg{} in a real environment using the experimental framework presented
  in \autoref{fig:regseg-evworkflows}.
We processed 16 subjects from the \gls*{hcp} database using both \regseg{}
  and an in-house replication of the \acrfull*{t2b} method.
\Regseg{} obtained very high accuracy, with an aggregate 95\% \gls*{ci} of 0.56--0.66 [mm], which was
  below the pixel size of 1.25 mm.
The misregistration error that remained after \regseg{} was significantly lower ($p <$ 0.01) than the
  error corresponding to the \gls*{t2b} correction according to Kruskal-Wallis H-tests
  (\autoref{tab:results_real}).
Visual inspections of all the results (\suppl{section S5}) and the violin plots in
  \autoref{fig:regseg-results_real} confirmed that \regseg{} achieved higher accuracy
  than the \gls*{t2b} method in our settings.
We carefully configured the \gls*{t2b} method using the same algorithm and the
  same settings employed in a widely-used tool for \gls*{dmri} processing.
However, cross-comparison experiments are prone to the so-called \emph{instrumentation bias}
  \citep{tustison_instrumentation_2013}.
Therefore, these results did not prove that \regseg{} \emph{is better than} \gls*{t2b},
  but indicated that \regseg{} is a reliable option in this application field.
\revcomment[RV\#1(C.5)]{%
Finally, we also contributed proposing a piecewise-smooth segmentation model defined by
  a selection of nested surfaces to partition the multispectral space
  comprehending the \gls*{fa} and the \gls*{adc} maps and ultimately identify these
  structures in \gls*{dmri} space.
We also demonstrated the smoothness of the objective function on five of the real datasets
  (\suppl{Figure S2}), taking advantage of the directional restriction of possible distortions.
However, convergence of \regseg{} can be severely affected when surfaces are not dense enough.
Using the digital phantoms, we decimated the surfaces with large factors and
  effectively displaced the minimum of the shape-gradients from the minimum of the
  objective function.
Thus, the surfaces must be densely sampled to enable the use of the presented method.
}%

Beyond the presented application on \gls*{dmri} data, \regseg{} can be indicated in situations
  where there are precise surfaces delineating the structure, a target multivariate
  image in which the surfaces must be fitted, and the mapping between the surfaces and
  the volume encodes a relevant physiological information, such as the normal/abnormal
  development or the macroscopic dynamics of organs and tissues.
For instance, \regseg{} may be applied in fields like neonatal brain image segmentation
  in longitudinal MRI studies of the early developmental patterns \citep{shi_neonatal_2010}.
In these studies, the surfaces obtained in a mature timepoint of the brain are retrospectively
  propagated to the initial timepoints, regardless the changes of the contrast and spatial
  development between them.
More generally, \regseg{} may also be applied to the personalized study of longitudinal alteration
  of the brain using multispectral images, for instance in the case of traumatic brain
  injury \citep{irimia_structural_2014} or in the development of brain tumors
  \citep{weizman_semiautomatic_2014}.




% \paragraph*{Prospects}
% First extensions of this work will study more appropriate features to build the energy functional
%   on, enabling to perform \regseg{} directly on the raw \gls*{dmri} data.
% A second outlook covers incorporating knowledge about the distortion by initializing our method
%   with the theory-based displacement field that can be estimated with fieldmaps.
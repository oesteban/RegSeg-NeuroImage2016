% -*- root: 00-main.tex -*-
\section{Discussion}
\label{sec:discussion}

\newcomment[RV\#1(C.3)]{%
\paragraph*{Contributions}\label{sec:related_work} %
Previously, joint segmentation and registration have been applied successfully to other problems
such as longitudinal object tracking \citep{paragios_level_2003} and atlas-based
  segmentation \citep{gorthi_active_2011}.
The most common approach to solve the problem simultaneously is optimizing a deformation model
  (registration) that supports the evolution the active contours (segmentation), like
  \citep{paragios_level_2003,yezzi_variational_2003}.
\cite{unal_coupled_2005}, and later \cite{wang_joint_2006}, replaced the linear registration
  transform of \cite{yezzi_variational_2003} with a free-form deformation field.
\cite{droske_mumfordshah_2009} reviewed the existing techniques and proposed two different
  approaches for applying the Mumford-Shah functional \citep{mumford_optimal_1989} during simultaneous
  registration and segmentation by propagating the deformation field from
  the contours onto the whole image definition.
Finally, \cite{gorthi_active_2011} extended the existing methodologies using a multiphase
  level set function to register several active contours during the application
  of atlas-based segmentation.
Unlike the aforementioned registration-and-segmentation methods, \regseg{} uses shape-gradients
  \citep{herbulot_segmentation_2006} computed on a hierarchical set of explicit surfaces
  (triangularized meshes) that substitute the multiphase level sets.
Recently, \cite{guyader_combined_2011} proposed a simultaneous segmentation and
  registration method in 2D using level sets and a nonlinear elasticity smoother on the
  displacement vector field, which preserves the topology even with very large deformations.
\Regseg{} includes an anisotropic regularizer for the displacements field proposed by
  \cite{nagel_investigation_1986}.
This regularization strategy conceptually falls in the midway between the Gaussian smoothing
  generally included in most of the existing methodologies, and the complexity of
  the elasticity smoother of \cite{guyader_combined_2011}.

An important antecedent of \regseg{} is \emph{bbregister} \citep{greve_accurate_2009}.
The tool has been widely adopted as the standard registration method to be used along with the \gls*{epi}
  correction of choice.
It implements a linear mapping, and uses 3D active contours with edges\footnote{A three-dimensional active contour
  is a surface and it is ``with edges'' when the contours evolve in search of abrupt intensity steps
  (the edges) within the target image.} to search for intensity boundaries in the \lowb{} image.
The active contours are initialized using surfaces extracted from the \gls*{t1} using
  \emph{FreeSurfer} \citep{fischl_freesurfer_2012}: the \emph{pial} surface (exterior of the
  cortical \gls*{gm}) and the \emph{white} surface (the \gls*{wm}/\gls*{gm} interface).
The \lowb{} image only includes a detectable frontier for the pial surface, and thus
  \emph{bbregister} is limited to aligning the cortical layer in this
  application.
To overcome the problem of nonlinear distortions, \emph{bbregister} excludes the
  regions that are typically warped from the boundary search.
Indeed, the distortion must be addressed separately because it is not supported by
  the affine transformation model.
\Regseg{} can be seen as a derivative of \emph{bbregister} for the use of active surfaces.
However, the deformation model is nonlinear and the surfaces in \regseg{} look for the
  homogeneity within the regions enclosed, instead of image edges.}

\newcomment[RV\#1(C.5)]{%
Finally, we also contribute proposing a piecewise-smooth segmentation model defined by
  a selection of nested surfaces to partition the multispectral space
  comprehending the \gls*{fa} and the \gls*{adc} maps and ultimately identify these
  structures in \gls*{dmri} space.}
With the definition of appropriate models, \regseg{} may be applied in other fields like
  neonatal brain image segmentation in longitudinal \gls*{mri} studies like \citep{shi_neonatal_2010}
  in which the surfaces obtained in a mature timepoint of the brain can be retrospectively
  propagated to the initial timepoints, regardless the changes of the contrast and spatial
  development between timepoints.

\paragraph*{Accuracy tests}
The hypothesis tested in our study was that reliable image registration can be performed
  by searching for the homogeneous regions defined by a set of nested surfaces in a
  multispectral image
The surfaces correspond to precise contours extracted from another image of the same subject
  (i.e. a \gls*{t1} image, or a different time step).
We demonstrated that active contours without edges can be used successfully to drive a
  deformation supported by B-spline basis functions with digital phantoms.
We randomly deformed four different phantom models to mimic three homogeneous regions
  (\gls*{wm}, \gls*{gm}, and \acrlong*{csf}) and we used them to simulate \gls*{t1} and \gls*{t2}
  images at two resolution levels.
After registration with \regseg{}, we measured the Hausdorff distance between the
  projected contours obtained using the ground-truth warping and our estimates.
We concluded that the errors were significantly lower than the voxel resolution.
We also assessed the 95\% \gls*{ci}, which yielded an aggregate interval of
  0.64--0.66 [mm] for the low resolution phantoms (2.0 mm isotropic voxel) and
  0.34--0.38 [mm] for the high resolution phantoms (1.0 mm isotropic).
Therefore, we also concluded that the error was bounded above by half of the
  voxel spacing.
\newcomment[RV\#1(C.8)]{%}
The distributions of errors along surfaces vary importantly depending on the shape of the
  phantom (see \autoref{fig:phantom}B).
The misregistration error of the ``gyrus'' phantom showed a much lower spread than that
  for the other shapes.
We argue that the symmetry of those other shapes posed difficulties in driving the contours
  towards the appropriate region and producing some ``sliding'' effect between the
  faces of the surfaces and their ground-truth position.
This effect should not be present in real datasets, thanks to the very convoluted cortical
  layer, and the directional restriction of distortion.}

\paragraph*{Application to real data}
We designed \regseg{} as a method for segmenting \gls*{dmri} data by exploiting the
  anatomical information extracted from a structural image (typically a \gls*{t1} image)
  of the subject.
Current pipelines using whole-brain tractography usually solve this problem with a two-step approach.
First, the images are corrected for nonlinear distortions using auxiliary acquisitions
  such as fieldmaps \citep{jezzard_correction_1995}, \glspl*{dwi} with reversed \gls*{pe}
  blips \citep{chiou_simple_2000}, or \gls*{t2} images \citep{kybic_unwarping_2000}.
Second, the segmentation is projected from a reference \gls*{t1} image using linear
  registration \citep{greve_accurate_2009}.
\Regseg{} addresses this joint problem in a single step and it does not require any additional
  acquisition other than the minimal protocol using only \gls*{t1} and \gls*{dmri} images.
This situation is found commonly in historical datasets.
Moreover, since the structural information is projected into the native space of \gls*{dmri}
  reconstruction and tractography can be performed without resampling data to an undistorted
  space.

We evaluated \regseg{} in a real environment using the experimental framework presented
  in \autoref{fig:evworkflows}.
We processed 16 subjects from the \gls*{hcp} database using both \regseg{}
  and an in-house replication of the \acrfull*{t2b} method.
\Regseg{} obtained very high accuracy, with an aggregate 95\% \gls*{ci} of 0.56--0.66 [mm], which was
  below the pixel size of 1.25 mm.
The misregistration error that remained after \regseg{} was significantly lower ($p < 0.01$) than the
  error corresponding to the \gls*{t2b} correction according to Kruskal-Wallis H-tests
  (\autoref{tab:results_real}).
Visual inspections of all the results (\suppl{section S5}) and the violin plots in
  \autoref{fig:results_real} confirmed that \regseg{} performed better than the \gls*{t2b} method
  in our settings.
We carefully configured the \gls*{t2b} method using the same algorithm and the
  same settings employed in a widely-used tool.
However, cross-comparison experiments are prone to so-called \emph{instrumentation bias}
  \citep{tustison_instrumentation_2013}.
Therefore, these results do not prove that \regseg{} \emph{is better than} \gls*{t2b}.
Our results suggest that \regseg{} is a reliable option in this application field.
In addition, the \gls*{t2b} may introduce an additional (and small) error during the necessary
  registration of \gls*{t2} in the \gls*{t1} space.

% \paragraph*{Prospects}
% First extensions of this work will study more appropriate features to build the energy functional
%   on, enabling to perform \regseg{} directly on the raw \gls*{dmri} data.
% A second outlook covers incorporating knowledge about the distortion by initializing our method
%   with the theory-based displacement field that can be estimated with fieldmaps.